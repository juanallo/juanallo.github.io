---
import './base.css';

import avatar from '@/images/avatar.png';
import { Footer } from '@/partials/Footer';
import { Navbar } from '@/partials/Navbar';
import { AppConfig } from '@/utils/AppConfig';

const {
  head: { title, description, canonical, noindex, url, image, imgAlt, pubDate },
} = Astro.props;

const path = url ? `${AppConfig.base_path}${url}` : `${AppConfig.base_path}/`;
const finalImage = AppConfig.base_path + (image ? image.src : avatar.src);
const width = image?.width ?? avatar.width;
const height = image?.height ?? avatar.height;
const format = image?.format ?? avatar?.format;
const canonicalHref = canonical ?? path;
const ogType = pubDate ? 'article' : 'website';
---

<html lang='en'>
  <head>
    <meta charset='UTF-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
    <title>{title}</title>
    <meta name='theme-color' content='#111827' />
    <link rel='alternate' type='application/rss+xml' href='/rss.xml' />
    <link rel='icon' type='image/x-icon' href='/favicon.jpg' />
    <link rel='apple-touch-icon' href='/favicon.jpg' />
    <link rel='manifest' href='/manifest.json' />
    <!-- Preconnect to analytics domains -->
    <link rel='preconnect' href='https://www.googletagmanager.com' />
    <link rel='preconnect' href='https://www.google-analytics.com' />

    <meta name='description' content={description} />
    <meta name='author' content={AppConfig.author} />
    <link rel='canonical' href={canonicalHref} item-prop='url' />
    {noindex && <meta name="robots" content="noindex,nofollow" />}

    <meta property='og:title' content={title} />
    <meta property='og:site_name' content={AppConfig.site_name} />
    <meta property='og:description' content={description} />
    <meta property='og:type' content={ogType} />
    <meta property='og:url' content={path} />
    <meta property='og:locale' content='en_US' />
    <meta property='og:image' itemprop='image' content={finalImage} />
    {imgAlt && <meta property="og:image:alt" content={imgAlt} />}

    <meta property='og:image:width' content={width} />
    <meta property='og:image:height' content={height} />
    <meta property='og:image:type' content={format} />

    <meta name='twitter:text:title' content={title} />
    <meta name='twitter:title' content={title} />
    <meta name='twitter:url' content={path} />
    <meta name='twitter:description' content={description} />
    <meta name='twitter:image' content={finalImage} />
    <meta name='twitter:creator' content='@juan_allo' />
    <meta name='twitter:site' content='@juan_allo' />
    <meta name='twitter:card' content='summary_large_image' />
    <meta name='twitter:image:width' content={width} />
    <meta name='twitter:image:height' content={height} />

    {pubDate && (
      <meta property="article:published_time" content={pubDate.toISOString()} />
    )}
    {pubDate && (
      <meta property="article:publisher" content={AppConfig.author} />
    )}

    <!-- Google tag (gtag.js) -->
    <script
      type='text/partytown'
      async
      src='https://www.googletagmanager.com/gtag/js?id=G-MXRS5WCX8T'
    >

    </script>
    <script type='text/partytown'>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());

      gtag('config', 'G-MXRS5WCX8T');
    </script>
  </head>
  <body class='bg-slate-900 text-gray-100'>
    <a
      href='#main'
      class='sr-only z-50 border border-cyan-400 bg-transparent px-4 py-2 font-mono text-cyan-400 focus:not-sr-only focus:absolute focus:left-4 focus:top-4 focus:bg-slate-800 focus:bg-opacity-80'
      >Skip to main content
    </a>
    <Navbar />

    <main id='main'>
      <slot></slot>
    </main>

    <div class='mt-8 w-full'>
      <Footer />
    </div>
  </body>
</html>
